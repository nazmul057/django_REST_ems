<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Employees per Department</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; margin: 16px; }
        .wrap { max-width: 720px; margin: 0 auto; }
        canvas { display: block; width: 100%; height: 360px; }
    </style>

</head>
<body>
    <div class="wrap">
    <h1>Employees per Department</h1>
    <div id="chartBox">
        <canvas id="deptChart"></canvas>
    </div>
    </div>

    <!-- Safely embed JSON from Django -->
    {{ labels|json_script:"labels-data" }}
    {{ data|json_script:"data-values" }}

    <script>
    const labels = JSON.parse(document.getElementById("labels-data").textContent);
    const dataVals = JSON.parse(document.getElementById("data-values").textContent);

    const ctx = document.getElementById("deptChart").getContext("2d");
    new Chart(ctx, {
        type: "pie",
        data: {
        labels: labels,
        datasets: [{
            data: dataVals,
            borderWidth: 1
        }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: "right" },
                title: { display: true, text: "Employees per Department" },
                tooltip: {
                    callbacks: {
                        label: (context) => {
                        const total = dataVals.reduce((a,b) => a+b, 0) || 1;
                        const val = context.parsed;
                        const pct = ((val / total) * 100).toFixed(1);
                        return ` ${context.label}: ${val} (${pct}%)`;
                        }
                    }
                }
            }
        }
    });
    </script>
</body>
</html>
